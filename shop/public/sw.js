import { clientsClaim } from 'workbox-core';
import { precacheAndRoute } from 'workbox-precaching';
import { registerRoute, setCatchHandler } from 'workbox-routing';
import { StaleWhileRevalidate, CacheFirst, NetworkFirst } from 'workbox-strategies';
import { BackgroundSyncPlugin } from 'workbox-background-sync';

declare let self: ServiceWorkerGlobalScope & { __WB_MANIFEST: Array<{url: string; revision?: string}>; skipWaiting: () => void };

clientsClaim();
self.skipWaiting();

// Precache app shell and assets injected at build time
precacheAndRoute([{"revision":"b727e5d756fc0d96dfbb734748918a58","url":"/_next/build/chunks/[root-of-the-server]__51225daf._.js"},{"revision":"fabd529aea721fe6b47890b58d6a9f72","url":"/_next/build/chunks/[root-of-the-server]__974941ed._.js"},{"revision":"baa8d0e8add43e03de86338552a42150","url":"/_next/build/chunks/[turbopack-node]_transforms_postcss_ts_31abd9fb._.js"},{"revision":"332787320892c9e9aa1768b5a7e7161f","url":"/_next/build/chunks/[turbopack]_runtime.js"},{"revision":"714c83335fd57c7d398c99b55df1a07c","url":"/_next/build/chunks/node_modules__pnpm_56ec7204._.js"},{"revision":"0dd8b2152adbb2a00af2e7f9916de8c6","url":"/_next/postcss.js"},{"revision":"f77f54ff72aaa997ac169d905573be95","url":"/_next/server/app/_not-found.html"},{"revision":"cf4d8a5c72e45a3b7f7c9903ce3144ec","url":"/_next/server/app/_not-found/page_client-reference-manifest.js"},{"revision":"b9be7af082bc7184d2e2784b7e72739c","url":"/_next/server/app/_not-found/page.js"},{"revision":"85e66d125fa4a25a0baf8304b2fef0ef","url":"/_next/server/app/[locale]/page_client-reference-manifest.js"},{"revision":"b8a31f6d35c50b222d4ffaf3826ed0b9","url":"/_next/server/app/[locale]/page.js"},{"revision":"07d0e63154a401ffbbfe049226c1d2f0","url":"/_next/server/app/[locale]/pos/page_client-reference-manifest.js"},{"revision":"067d6f8906828effad7e0fad003c54ee","url":"/_next/server/app/[locale]/pos/page.js"},{"revision":"33cd320d6295f25ba3179f4f70cfe7cb","url":"/_next/server/app/api/payments/route_client-reference-manifest.js"},{"revision":"08ca58355c0cfa25505d9730267dc9ed","url":"/_next/server/app/api/payments/route.js"},{"revision":"0e9b63bf97270dd63e483842c25d2916","url":"/_next/server/app/api/pos/availability/bulk/route_client-reference-manifest.js"},{"revision":"b5311cad995d925e34804f1dafd361e7","url":"/_next/server/app/api/pos/availability/bulk/route.js"},{"revision":"dc6caf68a55be6c31ce10a1622e39da2","url":"/_next/server/app/api/pos/bootstrap/route_client-reference-manifest.js"},{"revision":"f7f81f62e8d445931eb972d98a51d530","url":"/_next/server/app/api/pos/bootstrap/route.js"},{"revision":"c92df93a2ea8acab23f53a494358e73e","url":"/_next/server/app/api/sales/route_client-reference-manifest.js"},{"revision":"32ab08bad9244ee751e27fd970668bf2","url":"/_next/server/app/api/sales/route.js"},{"revision":"e4d680818134982740c3accfc8bbed52","url":"/_next/server/app/favicon.ico/route.js"},{"revision":"6a865cf0d71f7ab81e04ab66309d5fa6","url":"/_next/server/app/index.html"},{"revision":"97a8f722002bbdb2ded12135129cf99c","url":"/_next/server/app/manifest.webmanifest/route_client-reference-manifest.js"},{"revision":"008a4b7e76ee801e4b2b296f8e0da7b1","url":"/_next/server/app/manifest.webmanifest/route.js"},{"revision":"b597801a9a107fff1b7c5ccfab848f1a","url":"/_next/server/app/offline.html"},{"revision":"fb732d56f4b070cff6f6dabaad9e1390","url":"/_next/server/app/offline/page_client-reference-manifest.js"},{"revision":"411c2991d30b594486b5d77ebbccb8d7","url":"/_next/server/app/offline/page.js"},{"revision":"f9006c2ed50227e589f407e6695e90ac","url":"/_next/server/app/page_client-reference-manifest.js"},{"revision":"42b8347dada1fd73d99fe42a28a280fd","url":"/_next/server/app/page.js"},{"revision":"920d39736bbc077e767932b0907b27d3","url":"/_next/server/app/pos.html"},{"revision":"d6806c5734d610f89ef08d9a9a8ce971","url":"/_next/server/app/pos/page_client-reference-manifest.js"},{"revision":"110f61255368374500b08877a98de6d2","url":"/_next/server/app/pos/page.js"},{"revision":"3b027a49b552a8b91990dee9e113e8b8","url":"/_next/server/chunks/[root-of-the-server]__2f67003c._.js"},{"revision":"89781940c75d4548f91ce9cdd6f3a3e0","url":"/_next/server/chunks/[root-of-the-server]__5569d1a5._.js"},{"revision":"54719417315732d688cdfccdd708af77","url":"/_next/server/chunks/[root-of-the-server]__85517803._.js"},{"revision":"dfa0b3c0d6cd43431059d07596daf504","url":"/_next/server/chunks/[root-of-the-server]__b7e35c78._.js"},{"revision":"3ac57ef0f6127d15b5d57c33a7d86406","url":"/_next/server/chunks/[root-of-the-server]__bae589c7._.js"},{"revision":"e5925efb258ba1bbe1a9b96f3ac35295","url":"/_next/server/chunks/[root-of-the-server]__c96fa1e4._.js"},{"revision":"fe8296e812ddb65be5a6bbffa45ea684","url":"/_next/server/chunks/[root-of-the-server]__eda9784a._.js"},{"revision":"46b4011b79e42ebb24d709841b4f8c84","url":"/_next/server/chunks/[root-of-the-server]__f882a994._.js"},{"revision":"277608771be54cf51b4c8385eac05f72","url":"/_next/server/chunks/[turbopack]_runtime.js"},{"revision":"68123bc9f1df4880d678b721f5ad42f9","url":"/_next/server/chunks/89262_next_dist_esm_build_templates_app-route_6d5eef12.js"},{"revision":"ccfd59b1ceb28c33845eea53ee5217b0","url":"/_next/server/chunks/ssr/_0a605396._.js"},{"revision":"28ee8236dd7d02cfa23915471456e0a8","url":"/_next/server/chunks/ssr/_2949e156._.js"},{"revision":"8a30f719662a5b9a8cb3e20c1429552c","url":"/_next/server/chunks/ssr/_59eafe1a._.js"},{"revision":"c307926f368dccb5ab7ec9b2755a46db","url":"/_next/server/chunks/ssr/_5b65d4c4._.js"},{"revision":"42953a363a0bc7756c837083a0beaf23","url":"/_next/server/chunks/ssr/_61cb72dd._.js"},{"revision":"786c303ce78185cf90ea7c3dc6d694c9","url":"/_next/server/chunks/ssr/_76ce8334._.js"},{"revision":"90f58f68c818e60756943573d12da93d","url":"/_next/server/chunks/ssr/_819f75cf._.js"},{"revision":"a0fb63e14d44caaf7bf83d5d026d9736","url":"/_next/server/chunks/ssr/[externals]_next_dist_shared_lib_no-fallback-error_external_59b92b38.js"},{"revision":"459e6e34be039a45acc2e3d8c645424c","url":"/_next/server/chunks/ssr/[root-of-the-server]__00221274._.js"},{"revision":"dc428b82dc3d6770316498469c1a8f4a","url":"/_next/server/chunks/ssr/[root-of-the-server]__011fabd7._.js"},{"revision":"b783f44641f171e21f53d95dd155a90d","url":"/_next/server/chunks/ssr/[root-of-the-server]__0bc35698._.js"},{"revision":"d4b3580f9655d217af30ba592c7baf9d","url":"/_next/server/chunks/ssr/[root-of-the-server]__251afef6._.js"},{"revision":"d093b65ec66e407e12b1edd0de0017ca","url":"/_next/server/chunks/ssr/[root-of-the-server]__2d182dd7._.js"},{"revision":"6a6166e81e390c4e63c2d7a953f662b9","url":"/_next/server/chunks/ssr/[root-of-the-server]__3188a105._.js"},{"revision":"4adb8a28e3fae5382ab4097245ccc207","url":"/_next/server/chunks/ssr/[root-of-the-server]__4c075b4f._.js"},{"revision":"048624442a39bc3ce254e9b4162fa40e","url":"/_next/server/chunks/ssr/[root-of-the-server]__4c32c395._.js"},{"revision":"724d43a67e0b8b56ae20faf1578453fa","url":"/_next/server/chunks/ssr/[root-of-the-server]__5d503893._.js"},{"revision":"01f4d2427877cd2986c8b9b92d369193","url":"/_next/server/chunks/ssr/[root-of-the-server]__6dbfca00._.js"},{"revision":"13893117e27ee54b803a772e9138963c","url":"/_next/server/chunks/ssr/[root-of-the-server]__7b1336f3._.js"},{"revision":"c3baa75b85acfd7cd258529d8e72b177","url":"/_next/server/chunks/ssr/[root-of-the-server]__8f6d3dc4._.js"},{"revision":"b85e5b2ca101e912525d27403c62d143","url":"/_next/server/chunks/ssr/[root-of-the-server]__b27d3c24._.js"},{"revision":"a8803742d3a78196d7761d85a4f95f17","url":"/_next/server/chunks/ssr/[root-of-the-server]__cbca326e._.js"},{"revision":"b88e1791866d90b071062e69397a0927","url":"/_next/server/chunks/ssr/[root-of-the-server]__d55da604._.js"},{"revision":"cc601a80fb88963ef4047903eeaac3b1","url":"/_next/server/chunks/ssr/[root-of-the-server]__f03e2682._.js"},{"revision":"1f2bfc2e1970b53b3307e46b894bec57","url":"/_next/server/chunks/ssr/[root-of-the-server]__fcb55d89._.js"},{"revision":"42fd8d274db4f93a3a7b5840e4e9b269","url":"/_next/server/chunks/ssr/[root-of-the-server]__fdb3c16d._.js"},{"revision":"7e63ea24dc55598afc7abb8badda19a1","url":"/_next/server/chunks/ssr/[turbopack]_runtime.js"},{"revision":"46147992e60d1160d8ae7b47822e1248","url":"/_next/server/chunks/ssr/89262_next_61960185._.js"},{"revision":"7172c782a7c247415e96c752dee5c77b","url":"/_next/server/chunks/ssr/89262_next_dist_6069b9b6._.js"},{"revision":"20ab7b6c43ff6e96fac438887eb8501b","url":"/_next/server/chunks/ssr/89262_next_dist_ad702471._.js"},{"revision":"ea73bed0e086bfeb4d65976c2069deb6","url":"/_next/server/chunks/ssr/89262_next_dist_client_components_builtin_forbidden_c3a84d8c.js"},{"revision":"70cea4d59edd270db4b38dacaf0009f8","url":"/_next/server/chunks/ssr/89262_next_dist_client_components_builtin_global-error_7bcb2a1e.js"},{"revision":"a0e15567d5661effddf833b5b2f4a987","url":"/_next/server/chunks/ssr/89262_next_dist_client_components_builtin_unauthorized_b8517966.js"},{"revision":"f4bca73c967800214c82667284e79e68","url":"/_next/server/chunks/ssr/89262_next_dist_client_components_e3f40753._.js"},{"revision":"aaca011444f33e5b1ab36333bb2d7965","url":"/_next/server/chunks/ssr/89262_next_dist_da6cd236._.js"},{"revision":"496e07ccadf02de880ea83ac0f04d8f0","url":"/_next/server/chunks/ssr/89262_next_dist_esm_0f0fef48._.js"},{"revision":"40ebfbfaf3401ce42ff273901d319043","url":"/_next/server/chunks/ssr/97745_next-intl_dist_esm_production_shared_NextIntlClientProvider_952ecdf9.js"},{"revision":"f9bdf0224b631be4a79be34b3a2a25b4","url":"/_next/server/chunks/ssr/c3c0f_use-intl_dist_esm_production_react_b29b03cf.js"},{"revision":"26f61ecfe8340e7e6d377fe728c96541","url":"/_next/server/chunks/ssr/node_modules__pnpm_0e80b065._.js"},{"revision":"6715e26b5c22690668d1276df25a413a","url":"/_next/server/chunks/ssr/node_modules__pnpm_38b5a5d9._.js"},{"revision":"47141e49c4c662322edfeebe0f7590e0","url":"/_next/server/chunks/ssr/node_modules__pnpm_d563237c._.js"},{"revision":"85301526c6b6756a6fba6d042dad002d","url":"/_next/server/chunks/ssr/node_modules__pnpm_f9b26463._.js"},{"revision":"4a40b5761be3e6e857c22250e771d76e","url":"/_next/server/chunks/ssr/src_app_[locale]_pos_page_tsx_bfc08de9._.js"},{"revision":"9b514ed42b6ad19c9960670ed086cb3e","url":"/_next/server/chunks/ssr/src_app_31a0a560._.js"},{"revision":"be07f43623a56f62c322b16deab0bc9c","url":"/_next/server/chunks/ssr/src_app_ca777385._.js"},{"revision":"7f237c6e123389e35dbe83d70c788380","url":"/_next/server/edge/chunks/[root-of-the-server]__b51a22b9._.js"},{"revision":"1d1da5875f6a06f2418ca145f90a782f","url":"/_next/server/edge/chunks/edge-wrapper_157d6664.js"},{"revision":"b73b76a9f38fbc1a1dda7357eb1deb64","url":"/_next/server/edge/chunks/turbopack-edge-wrapper_0eedefe8.js"},{"revision":"d7aa1834e4b5ee75408143d266ce2f1c","url":"/_next/server/interception-route-rewrite-manifest.js"},{"revision":"c1fd62535d37b5660839b9b00e3fe4bc","url":"/_next/server/middleware-build-manifest.js"},{"revision":"ddde2f75fe067c922d5acdd08e9e07b0","url":"/_next/server/next-font-manifest.js"},{"revision":"2efdcf56f289f22ad99c3924a7fb52f0","url":"/_next/server/pages/_app.js"},{"revision":"eadf4ca90b6da0a15fd9cc32db1beb2a","url":"/_next/server/pages/_document.js"},{"revision":"550b49e1965d05f227eec586292b2584","url":"/_next/server/pages/_error.js"},{"revision":"f77f54ff72aaa997ac169d905573be95","url":"/_next/server/pages/404.html"},{"revision":"30644f1a5eac4b96e83dadee4ab5e7e5","url":"/_next/server/pages/500.html"},{"revision":"90e6e45ebd27fa089b529e111fc62719","url":"/_next/server/server-reference-manifest.js"},{"revision":"3b0e29b7fce6d6cb3d2bf9e6d6691158","url":"/_next/static/cCPvJUuW0PnOj6AIJLVPk/_buildManifest.js"},{"revision":"b404e23d62d95bafd03ad7747cc0e88b","url":"/_next/static/cCPvJUuW0PnOj6AIJLVPk/_ssgManifest.js"},{"revision":"b3ec32debfbf14fe260204489776d6cb","url":"/_next/static/chunks/02fda26597ba8081.js"},{"revision":"0bcf9b09e7baccecf6359900ce32c589","url":"/_next/static/chunks/034b7823d1abe21e.js"},{"revision":"9c59b97f83eca28645faeac1cc9758fc","url":"/_next/static/chunks/0b3668f1e2881503.js"},{"revision":"0197a84322e16082238fd7641759b26b","url":"/_next/static/chunks/0ea6db04af9d0d0d.js"},{"revision":"1700efd0169cf32376d022bcaa26fdae","url":"/_next/static/chunks/15dec4993cae3ee8.js"},{"revision":"f2f8ccbfd44676c19cf6c83b7f03792f","url":"/_next/static/chunks/26b40bdd2fea0a84.js"},{"revision":"5b04be5adbb25d5cea40d0c9314e757b","url":"/_next/static/chunks/30a7182412cf70b2.js"},{"revision":"f228d926d3e78c214e71e32610c1ba06","url":"/_next/static/chunks/3522f78ebc0d2c1e.js"},{"revision":"662d5204416050b5a824a2052b317420","url":"/_next/static/chunks/3eba18e927d23f95.js"},{"revision":"743d505c490f4e3a9c68250d4684bcbb","url":"/_next/static/chunks/41181bdcaf96cd3a.js"},{"revision":"fa00178b1ffe10719087231aa2ead5c8","url":"/_next/static/chunks/6b0877ca4c56f5bc.js"},{"revision":"9cdbbebe4aed0616bb239d592933b2b7","url":"/_next/static/chunks/76c7da67f6024288.js"},{"revision":"50be367efd2fad9b3c2fb186a19bcb42","url":"/_next/static/chunks/77d475c6d547648e.js"},{"revision":"2095e49b94b29cf52868cef33a1706cc","url":"/_next/static/chunks/7d7c9999de279255.js"},{"revision":"cc8ffad492cffcb7ba0c2a3515a37929","url":"/_next/static/chunks/8194a928829db245.js"},{"revision":"846118c33b2c0e922d7b3a7676f81f6f","url":"/_next/static/chunks/a6dad97d9634a72d.js"},{"revision":"d69a017a38cbfdcdc8cef50a03a4da20","url":"/_next/static/chunks/a89473a032606729.css"},{"revision":"49ba1b2a14637277dc162420d86e8a3f","url":"/_next/static/chunks/b40efb68809e6625.js"},{"revision":"e175462c286901b3dc8f298e6bdf1443","url":"/_next/static/chunks/c445f8f5d3e0eb70.js"},{"revision":"9cf041503212ecddfef66c6361de8f2f","url":"/_next/static/chunks/d8af7715cdfe95c5.js"},{"revision":"5844203f1b2e2c264791b4e6b4aa6971","url":"/_next/static/chunks/f5aa5b0684fb84f7.js"},{"revision":"bf1af7e11344b7b3b398abeb47b0153a","url":"/_next/static/chunks/feaab7b88841ca6f.js"},{"revision":"db9e23765018fa98128adb347df221f8","url":"/_next/static/chunks/turbopack-02d3cae80f38a9e2.js"},{"revision":"410d182d5a9ce24cf9ae3a3b7a742ee3","url":"/_next/static/chunks/turbopack-bdf78665d3646a23.js"},{"revision":"271d1918b1a3da261837a61eb4957dc1","url":"/_next/static/chunks/turbopack-dae980287a1cbb52.js"},{"revision":"fc002557f215681e64f2ba19c2fc08f3","url":"/_next/static/media/1d2cc0c079997359-s.3e57c327.woff2"},{"revision":"9dedb65bba3275c44f2c7687749291ce","url":"/_next/static/media/48e6fa8a5baca31f-s.p.33d01b36.woff2"},{"revision":"69e22700847efcd4251ca0ca1f836515","url":"/_next/static/media/4b676bcffc00356a-s.p.c22aaca1.woff2"},{"revision":"8189abd2eb7f5085239289d0dd04da02","url":"/_next/static/media/9ff27b8a0a8f3dc0-s.p.9cb3a3e2.woff2"},{"revision":"9dfa03ce2ef5bc3aa9f0f8a5b3e7a0ba","url":"/_next/static/media/a5b03b231ce290a0-s.890a9a09.woff2"},{"revision":"cec73543deed2c5a2aad442c82408919","url":"/_next/static/media/d41831e24743a3c1-s.ae65d18e.woff2"},{"revision":"ae2ff29be66867a6d935af992ba8001b","url":"/_next/static/media/e7b64a7fde1a3d32-s.c2772084.woff2"},{"revision":"c30c7d42707a47a3f4591831641e50dc","url":"/_next/static/media/favicon.0b3bf435.ico"}] || []);

// Runtime: static assets
registerRoute(
  ({ request }) => request.destination === 'style' || request.destination === 'script' || request.destination === 'font',
  new StaleWhileRevalidate({ cacheName: 'static-assets' })
);

// Runtime: products & customers lookup (CacheFirst)
registerRoute(
  ({ url, request }) => request.method === 'GET' && (/\/api\/products/.test(url.pathname) || /\/api\/customers/.test(url.pathname)),
  new CacheFirst({ cacheName: 'lookups', plugins: [] })
);

// Runtime: availability (NetworkFirst)
registerRoute(
  ({ url, request }) => request.method === 'GET' && /\/api\/inventory\/availability/.test(url.pathname),
  new NetworkFirst({ cacheName: 'availability' })
);

// Background Sync Queues
const salesQueue = new BackgroundSyncPlugin('salesQueue', { maxRetentionTime: 24 * 60 });
const paymentsQueue = new BackgroundSyncPlugin('paymentsQueue', { maxRetentionTime: 24 * 60 });

registerRoute(
  ({ url, request }) => request.method === 'POST' && /\/api\/sales/.test(url.pathname),
  new (class extends StaleWhileRevalidate { })({ cacheName: 'post-sales', plugins: [salesQueue] }),
  'POST'
);

registerRoute(
  ({ url, request }) => request.method === 'POST' && /\/api\/payments/.test(url.pathname),
  new (class extends StaleWhileRevalidate { })({ cacheName: 'post-payments', plugins: [paymentsQueue] }),
  'POST'
);

// Offline fallback: route to /offline for navigations
setCatchHandler(async ({ event }) => {
  if (event.request.destination === 'document') {
    try {
      const resp = await caches.match('/offline.html');
      if (resp) return resp;
    } catch {}
    return Response.redirect('/offline');
  }
  return Response.error();
});

